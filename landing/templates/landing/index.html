{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="{{ meta.description }}">
    <meta name="keywords" content="{{ meta.keywords }}">
    
    <!-- Open Graph Meta Tags -->
    <meta property="og:title" content="{{ meta.title }}">
    <meta property="og:description" content="{{ meta.description }}">
    <meta property="og:image" content="{% static meta.og_image %}">
    <meta property="og:url" content="{{ request.build_absolute_uri }}">
    
    <title>{{ meta.title }}</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="{% static 'landing/img/favicon.png' %}">

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700;800&family=Inter:wght@300;400;500;600&family=Great+Vibes&display=swap" rel="stylesheet">
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="{% static 'landing/css/styles.css' %}">
</head>
<body>
    <!-- Loader -->
    <div class="loader" id="loader">
        <div class="loader-spinner"></div>
    </div>
    
    <!-- Header -->
    <header class="header" id="header">
        <nav class="navbar">
            <div class="logo-container">
                <img src="{% static 'landing/img/logo-renovar.png' %}" alt="{{ candidate.campaign_slogan }}" class="logo-img">
            </div>
            <button class="menu-toggle" id="menuToggle">
                <span>☰</span>
            </button>
        </nav>
        
        <!-- Mobile Menu -->
        <div class="mobile-menu" id="mobileMenu">
            <a href="#hero">Inicio</a>
            <a href="#team">Equipo</a>
            <a href="#plan">Plan Estratégico</a>
            <a href="#donate">Donar</a>
            <a href="#register">Registrarse</a>
            <a href="#contact">Contacto</a>
        </div>
    </header>
    
    <!-- Hero Section -->
    <section class="hero" id="hero">
        <div class="hero-content">
            <h1>{{ candidate.name }}</h1>
            <p class="subtitle">{{ candidate.title }}<br>{{ candidate.subtitle }}</p>
            <p class="hero-text">{{ candidate.message }}</p>
            
            <h2 style="font-size: 2.5rem; margin: 30px 0; font-weight: 800;">¡Únete!</h2>
            
            <p style="margin-bottom: 30px; font-size: 1.1rem;">
                Haz tu donativo a través de<br>
                <strong>{{ donation.platform }}</strong><br>
                a <strong style="color: #FFEB3B;">{{ donation.handle }}</strong>
            </p>
            
            <div style="margin-top: 40px;">
                <a href="#donate" class="btn btn-primary">Donar Ahora</a>
                <a href="#register" class="btn btn-outline" style="margin-left: 15px;">Registrarse</a>
            </div>
        </div>
    </section>
    
    <!-- Team Section -->
    <section class="team-section" id="team">
        <div class="container">
            <div class="section-header">
                <h2>Nuestro</h2>
                <div class="script">Equipo</div>
            </div>
            
            <div class="team-grid">
                {% for member in team_members %}
                <div class="team-member animate-on-scroll">
                    <div class="team-member-image">
                        {% if member.image %}
                        <img src="{% static member.image %}" alt="{{ member.name }}">
                        {% else %}
                        <img src="{% static 'landing/img/placeholder-avatar.jpg' %}" alt="{{ member.name }}">
                        {% endif %}
                    </div>
                    <h3>{{ member.name }}</h3>
                    <p class="role">{{ member.role }}</p>
                    <p class="district">{{ member.district }}</p>
                </div>
                {% endfor %}
                
                <!-- Featured Member -->
                <div class="team-member juan-destacado animate-on-scroll">
                    <div class="team-member-image">
                        {% if featured_member.image %}
                        <img src="{% static featured_member.image %}" alt="{{ featured_member.name }}">
                        {% else %}
                        <img src="{% static 'landing/img/placeholder-avatar.jpg' %}" alt="{{ featured_member.name }}">
                        {% endif %}
                    </div>
                    <h3>{{ featured_member.name }}</h3>
                    <p class="role">{{ featured_member.role }}</p>
                    <p class="district">{{ featured_member.district }}</p>
                </div>
            </div>
        </div>
    </section>
    
    <!-- Strategic Plan Section -->
    <section class="strategic-plan" id="plan">
        <div class="container">
            <h2>Plan</h2>
            <div class="script">Estratégico</div>
            
            <div class="plan-cards">
                {% for plan in strategic_plans %}
                <div class="plan-card animate-on-scroll">
                    <h3>{{ plan.title }}</h3>
                    <p>{{ plan.description }}</p>
                    <a href="#" class="btn btn-teal-outline">Leer más</a>
                </div>
                {% endfor %}
            </div>
        </div>
    </section>
    
    <!-- Donation Section -->
    <section class="donation-section" id="donate">
        <div class="container">
            <div class="donation-content animate-on-scroll">
                <h2>¡Únete!</h2>
                
                <div class="donation-info">
                    <p>Haz tu donativo a través de {{ donation.platform }} a:</p>
                    <div class="donation-handle">{{ donation.handle }}</div>
                </div>
                
                <div class="qr-container">
                    {% if donation.qr_code %}
                    <img src="{% static donation.qr_code %}" alt="QR Code para donar">
                    {% else %}
                    <div style="width: 100%; height: 100%; background: #E0E0E0; display: flex; align-items: center; justify-content: center; border-radius: 10px;">
                        <span style="color: #999;">QR Code</span>
                    </div>
                    {% endif %}
                </div>
                
                <a href="{% url 'landing:donate' %}" class="ath-button">
                    <img src="{% static 'landing/img/ath-logo.png' %}" alt="ATH" style="height: 25px;">
                    <span>ATH Móvil</span>
                </a>
                
                <p class="legal-text">{{ donation.legal_text }}</p>
                
                <div class="hashtag">{{ donation.hashtag }}</div>
            </div>
        </div>
    </section>
    
    <!-- Register Section -->
    <section class="register-section" id="register">
        <div class="container">
            <h2 class="animate-on-scroll">¡Regístrate!</h2>
            <p class="animate-on-scroll">
                Únete al movimiento de transformación del Colegio de Médicos.<br>
                Tu participación es fundamental para el cambio.
            </p>
            
            <!-- Formulario de Registro Integrado -->
            <div class="registration-form-container animate-on-scroll">
                {% if registration_form %}
                <form id="registrationForm" method="post" action="{% url 'landing:register-api' %}">
                    {% csrf_token %}
                    
                    <div class="form-row">
                        <div class="form-group-inline">
                            <label for="id_name">Nombre</label>
                            {{ registration_form.name }}
                        </div>
                        <div class="form-group-inline">
                            <label for="id_last_name">Apellidos</label>
                            {{ registration_form.last_name }}
                        </div>
                    </div>
                    
                    <div class="form-group-inline full-width">
                        <label for="id_postal_address">Dirección Postal</label>
                        {{ registration_form.postal_address }}
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group-inline">
                            <label for="id_phone_number">Teléfono</label>
                            {{ registration_form.phone_number }}
                        </div>
                        <div class="form-group-inline">
                            <label for="id_email">Email (opcional)</label>
                            {{ registration_form.email }}
                        </div>
                    </div>
                    
                    <div class="form-group-inline">
                        <label>¿Eres médico?</label>
                        <div class="radio-group-horizontal">
                            <label class="radio-label">
                                <input type="radio" name="is_doctor" value="True" onchange="toggleDoctorFields(this.value)">
                                Sí
                            </label>
                            <label class="radio-label">
                                <input type="radio" name="is_doctor" value="False" checked onchange="toggleDoctorFields(this.value)">
                                No
                            </label>
                        </div>
                    </div>
                    
                    <div id="doctorFields" class="doctor-fields" style="display: none;">
                        <div class="form-group-inline full-width">
                            <label for="id_service_location">¿Dónde provee servicios?</label>
                            {{ registration_form.service_location }}
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group-inline">
                                <label for="id_years_practicing">Años ejerciendo</label>
                                {{ registration_form.years_practicing }}
                            </div>
                            <div class="form-group-inline">
                                <label>¿Eres colegiado?</label>
                                <div class="radio-group-horizontal">
                                    <label class="radio-label">
                                        <input type="radio" name="is_licensed" value="True">
                                        Sí
                                    </label>
                                    <label class="radio-label">
                                        <input type="radio" name="is_licensed" value="False" checked>
                                        No
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group-inline">
                        <label>¿Necesitará ayuda con voto adelantado?</label>
                        <div class="radio-group-horizontal">
                            <label class="radio-label">
                                <input type="radio" name="needs_voting_help" value="True">
                                Sí
                            </label>
                            <label class="radio-label">
                                <input type="radio" name="needs_voting_help" value="False" checked>
                                No
                            </label>
                        </div>
                    </div>
                    
                    <div id="registrationMessages" style="margin-top: 20px;"></div>
                    
                    <button type="submit" class="btn btn-primary" id="submitBtn">
                        Completar Registro
                    </button>
                </form>
                {% else %}
                <a href="{% url 'landing:register' %}" class="btn btn-primary animate-on-scroll">Registrarme Ahora</a>
                {% endif %}
            </div>
        </div>
    </section>
    
    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <h3>{{ candidate.name }}</h3>
                <p class="subtitle">Candidato a la Presidencia del Colegio de Médicos</p>
            </div>
            
            <div class="countdown" id="countdown">
                <div class="countdown-item">
                    <span class="countdown-number" id="days">{{ countdown.days }}</span>
                    <span class="countdown-label">Días</span>
                </div>
                <div class="countdown-item">
                    <span class="countdown-number" id="hours">{{ countdown.hours }}</span>
                    <span class="countdown-label">Horas</span>
                </div>
                <div class="countdown-item">
                    <span class="countdown-number" id="minutes">{{ countdown.minutes }}</span>
                    <span class="countdown-label">Minutos</span>
                </div>
                <div class="countdown-item">
                    <span class="countdown-number" id="seconds">{{ countdown.seconds }}</span>
                    <span class="countdown-label">Segundos</span>
                </div>
            </div>
            
            <div class="social-links">
                {% if social_media.facebook %}
                <a href="{{ social_media.facebook }}" target="_blank" class="social-link">f</a>
                {% endif %}
                {% if social_media.twitter %}
                <a href="{{ social_media.twitter }}" target="_blank" class="social-link">𝕏</a>
                {% endif %}
                {% if social_media.instagram %}
                <a href="{{ social_media.instagram }}" target="_blank" class="social-link">📷</a>
                {% endif %}
                {% if social_media.linkedin %}
                <a href="{{ social_media.linkedin }}" target="_blank" class="social-link">in</a>
                {% endif %}
            </div>
            
            <div class="copyright">
                <p>&copy; 2024 {{ candidate.campaign_slogan }}. Todos los derechos reservados.</p>
                <p style="margin-top: 10px; font-size: 0.8rem;">
                    Pagado por el Comité Dr. Méndez Sexto
                </p>
            </div>
        </div>
    </footer>
    
    <script>
        // Hide loader when page is ready
        window.addEventListener('load', function() {
            setTimeout(function() {
                document.getElementById('loader').classList.add('hidden');
            }, 500);
        });
        
        // Mobile menu toggle
        const menuToggle = document.getElementById('menuToggle');
        const mobileMenu = document.getElementById('mobileMenu');
        
        menuToggle.addEventListener('click', function() {
            mobileMenu.classList.toggle('active');
        });
        
        // Close mobile menu when clicking on a link
        document.querySelectorAll('.mobile-menu a').forEach(link => {
            link.addEventListener('click', function() {
                mobileMenu.classList.remove('active');
            });
        });
        
        // Header scroll effect
        window.addEventListener('scroll', function() {
            const header = document.getElementById('header');
            if (window.scrollY > 50) {
                header.classList.add('scrolled');
            } else {
                header.classList.remove('scrolled');
            }
        });
        
        // Smooth scrolling for anchor links
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    const headerHeight = document.getElementById('header').offsetHeight;
                    const targetPosition = target.getBoundingClientRect().top + window.scrollY - headerHeight;
                    window.scrollTo({
                        top: targetPosition,
                        behavior: 'smooth'
                    });
                }
            });
        });
        
        // Animate on scroll
        const observerOptions = {
            threshold: 0.1,
            rootMargin: '0px 0px -100px 0px'
        };
        
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('animated');
                }
            });
        }, observerOptions);
        
        document.querySelectorAll('.animate-on-scroll').forEach(el => {
            observer.observe(el);
        });
        
        // Countdown timer
        function updateCountdown() {
            fetch('{% url "landing:countdown-api" %}')
                .then(response => response.json())
                .then(data => {
                    if (data.ended) {
                        document.getElementById('countdown').innerHTML = `
                            <h3 style="color: var(--teal-primary);">${data.message}</h3>
                        `;
                    } else {
                        document.getElementById('days').textContent = String(data.days).padStart(2, '0');
                        document.getElementById('hours').textContent = String(data.hours).padStart(2, '0');
                        document.getElementById('minutes').textContent = String(data.minutes).padStart(2, '0');
                        document.getElementById('seconds').textContent = String(data.seconds).padStart(2, '0');
                    }
                })
                .catch(error => console.error('Error updating countdown:', error));
        }
        
        // Update countdown every second
        setInterval(updateCountdown, 1000);
    </script>
    
    {% if messages %}
    <script>
        // Display Django messages if any
        {% for message in messages %}
            alert('{{ message }}');
        {% endfor %}
    </script>
    {% endif %}
</body>
</html>