{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="{{ meta.description }}">
    <meta name="keywords" content="{{ meta.keywords }}">
    
    <!-- Open Graph Meta Tags -->
    <meta property="og:title" content="{{ meta.title }}">
    <meta property="og:description" content="{{ meta.description }}">
    <meta property="og:image" content="{% static meta.og_image %}">
    <meta property="og:url" content="{{ request.build_absolute_uri }}">
    
    <title>{{ meta.title }}</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="{% static 'landing/img/favicon.png' %}">

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700;800&family=Inter:wght@300;400;500;600&family=Great+Vibes&display=swap" rel="stylesheet">
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="{% static 'landing/css/styles.css' %}">
</head>
<body>
    <!-- Loader -->
    <div class="loader" id="loader">
        <div class="loader-spinner"></div>
    </div>
    
    <!-- Header -->
    <header class="header" id="header">
        <nav class="navbar">
            <div class="logo-container">
                <img src="{% static 'landing/img/logo-renovar.png' %}" alt="{{ candidate.campaign_slogan }}" class="logo-img">
            </div>
            <button class="menu-toggle" id="menuToggle">
                <span>☰</span>
            </button>
        </nav>
        
        <!-- Mobile Menu -->
        <div class="mobile-menu" id="mobileMenu">
            <a href="#hero">Inicio</a>
            <a href="#team">Equipo</a>
            <a href="#plan">Plan Estratégico</a>
            <a href="#donate">Donar</a>
            <a href="#register">Registrarse</a>
            <a href="#contact">Contacto</a>
        </div>
    </header>
    
    <!-- Hero Section -->
    <section class="hero" id="hero">
        <div class="hero-content">
            <h1>{{ candidate.name }}</h1>
            <p class="subtitle">{{ candidate.title }}<br>{{ candidate.subtitle }}</p>
            <p class="hero-text">{{ candidate.message }}</p>
            
            <h2 style="font-size: 2.5rem; margin: 30px 0; font-weight: 800;">¡Únete!</h2>
            
            <p style="margin-bottom: 30px; font-size: 1.1rem;">
                Haz tu donativo a través de<br>
                <strong>{{ donation.platform }}</strong><br>
                a <strong style="color: #FFEB3B;">{{ donation.handle }}</strong>
            </p>
            
            <div style="margin-top: 40px;">
                <a href="#donate" class="btn btn-primary">Donar Ahora</a>
                <a href="#register" class="btn btn-outline" style="margin-left: 15px;">Registrarse</a>
            </div>
        </div>
    </section>
    
    <!-- Team Section -->
    <section class="team-section" id="team">
        <div class="container">
            <div class="section-header">
                <h2>Nuestro</h2>
                <div class="script">Equipo</div>
            </div>
            
            <div class="team-grid">
                {% for member in team_members %}
                <div class="team-member animate-on-scroll">
                    <div class="team-member-image">
                        {% if member.image %}
                        <img src="{% static member.image %}" alt="{{ member.name }}">
                        {% else %}
                        <img src="{% static 'landing/img/placeholder-avatar.jpg' %}" alt="{{ member.name }}">
                        {% endif %}
                    </div>
                    <h3>{{ member.name }}</h3>
                    <p class="role">{{ member.role }}</p>
                    <p class="district">{{ member.district }}</p>
                </div>
                {% endfor %}
                
                <!-- Featured Member -->
                <div class="team-member juan-destacado animate-on-scroll">
                    <div class="team-member-image">
                        {% if featured_member.image %}
                        <img src="{% static featured_member.image %}" alt="{{ featured_member.name }}">
                        {% else %}
                        <img src="{% static 'landing/img/placeholder-avatar.jpg' %}" alt="{{ featured_member.name }}">
                        {% endif %}
                    </div>
                    <h3>{{ featured_member.name }}</h3>
                    <p class="role">{{ featured_member.role }}</p>
                    <p class="district">{{ featured_member.district }}</p>
                </div>
            </div>
        </div>
    </section>
    
    <!-- Strategic Plan Section -->
    <section class="strategic-plan" id="plan">
        <div class="container">
            <h2>Plan</h2>
            <div class="script">Estratégico</div>
            
            <div class="plan-cards">
                {% for plan in strategic_plans %}
                <div class="plan-card animate-on-scroll">
                    <h3>{{ plan.title }}</h3>
                    <p>{{ plan.description }}</p>
                    <a href="#" class="btn btn-teal-outline">Leer más</a>
                </div>
                {% endfor %}
            </div>
        </div>
    </section>
    
    <!-- Donation Section -->
    <section class="donation-section" id="donate">
        <div class="container">
            <div class="donation-content animate-on-scroll">
                <h2>¡Únete!</h2>
                
                <div class="donation-info">
                    <p>Haz tu donativo a través de {{ donation.platform }} a:</p>
                    <div class="donation-handle">{{ donation.handle }}</div>
                </div>
                
                <div class="qr-container">
                    {% if donation.qr_code %}
                    <img src="{% static donation.qr_code %}" alt="QR Code para donar">
                    {% else %}
                    <div style="width: 100%; height: 100%; background: #E0E0E0; display: flex; align-items: center; justify-content: center; border-radius: 10px;">
                        <span style="color: #999;">QR Code</span>
                    </div>
                    {% endif %}
                </div>
                
                <a href="{% url 'landing:donate' %}" class="ath-button">
                    <img src="{% static 'landing/img/ath-logo.png' %}" alt="ATH" style="height: 25px;">
                    <span>ATH Móvil</span>
                </a>
                
                <p class="legal-text">{{ donation.legal_text }}</p>
                
                <div class="hashtag">{{ donation.hashtag }}</div>
            </div>
        </div>
    </section>
    
<!-- Register Section - Añadir esto en el index.html después de la sección de donación -->
<section class="register-section" id="register">
    <div class="container">
        <div class="register-wrapper">
            <div class="register-header">
                <div class="header-badge">Registro</div>
                
                <div class="title-section">
                    <div class="title-main">¡Iniciemos la</div>
                    <div class="title-script">renovación!</div>
                    
                    <div class="doctor-name">
                        <span class="doctor-prefix">Dr.</span><br>
                        <span class="doctor-surname">Méndez<span class="doctor-lastname">Sexto</span></span>
                    </div>
                    
                    <div class="campaign-hashtag">#RenovarParaAvanzar</div>
                </div>
            </div>
            
            <div class="register-form-container">
                <form method="post" action="{% url 'landing:register' %}" id="registerForm" class="register-form">
                    {% csrf_token %}
                    
                    <div class="form-row">
                        <div class="form-group">
                            <input type="text" name="name" placeholder="Nombre" required>
                        </div>
                        
                        <div class="form-group">
                            <input type="text" name="lastname" placeholder="Apellidos" required>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <input type="email" name="email" id="email" placeholder="Correo electrónico" required>
                        <div class="email-validation" id="emailValidation"></div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <input type="text" name="address" placeholder="Dirección postal" required>
                        </div>
                        
                        <div class="form-group">
                            <input type="tel" name="phone" id="phone" placeholder="Número telefónico" required>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <textarea name="services" placeholder="¿Dónde ofrece servicios?" rows="2"></textarea>
                    </div>
                    
                    <div class="question-group">
                        <div class="question-section">¿Eres médico?</div>
                        <div class="radio-group">
                            <div class="radio-option">
                                <label>Sí</label>
                                <input type="radio" name="is_doctor" value="yes" id="doctor_yes">
                            </div>
                            <div class="radio-option">
                                <label>No</label>
                                <input type="radio" name="is_doctor" value="no" id="doctor_no">
                            </div>
                        </div>
                    </div>
                    
                    <div class="years-section" id="yearsSection" style="display: flex;">
                        <span>Años ejerciendo la disciplina</span>
                        <input type="number" name="years_practicing" id="years" min="0" max="70" placeholder="0">
                    </div>
                    
                    <div class="question-group">
                        <div class="question-section">¿Eres colegiado?</div>
                        <div class="radio-group">
                            <div class="radio-option">
                                <label>Sí</label>
                                <input type="radio" name="is_member" value="yes">
                            </div>
                            <div class="radio-option">
                                <label>No</label>
                                <input type="radio" name="is_member" value="no">
                            </div>
                        </div>
                    </div>
                    
                    <div class="question-group">
                        <div class="question-section">¿Necesitará ayuda con voto adelantado?</div>
                        <div class="radio-group">
                            <div class="radio-option">
                                <label>Sí</label>
                                <input type="radio" name="needs_help" value="yes">
                            </div>
                            <div class="radio-option">
                                <label>No</label>
                                <input type="radio" name="needs_help" value="no">
                            </div>
                        </div>
                    </div>
                    
                    <button type="submit" class="register-submit-btn">Enviar Registro</button>
                </form>
            </div>
        </div>
    </div>
</section>

    
    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <h3>{{ candidate.name }}</h3>
                <p class="subtitle">Candidato a la Presidencia del Colegio de Médicos</p>
            </div>
            
            <div class="countdown" id="countdown">
                <div class="countdown-item">
                    <span class="countdown-number" id="days">{{ countdown.days }}</span>
                    <span class="countdown-label">Días</span>
                </div>
                <div class="countdown-item">
                    <span class="countdown-number" id="hours">{{ countdown.hours }}</span>
                    <span class="countdown-label">Horas</span>
                </div>
                <div class="countdown-item">
                    <span class="countdown-number" id="minutes">{{ countdown.minutes }}</span>
                    <span class="countdown-label">Minutos</span>
                </div>
                <div class="countdown-item">
                    <span class="countdown-number" id="seconds">{{ countdown.seconds }}</span>
                    <span class="countdown-label">Segundos</span>
                </div>
            </div>
            
            <div class="social-links">
                {% if social_media.facebook %}
                <a href="{{ social_media.facebook }}" target="_blank" class="social-link">f</a>
                {% endif %}
                {% if social_media.twitter %}
                <a href="{{ social_media.twitter }}" target="_blank" class="social-link">𝕏</a>
                {% endif %}
                {% if social_media.instagram %}
                <a href="{{ social_media.instagram }}" target="_blank" class="social-link">📷</a>
                {% endif %}
                {% if social_media.linkedin %}
                <a href="{{ social_media.linkedin }}" target="_blank" class="social-link">in</a>
                {% endif %}
            </div>
            
            <div class="copyright">
                <p>&copy; 2024 {{ candidate.campaign_slogan }}. Todos los derechos reservados.</p>
                <p style="margin-top: 10px; font-size: 0.8rem;">
                    Pagado por el Comité Dr. Méndez Sexto
                </p>
            </div>
        </div>
    </footer>
    <!-- JavaScript para añadir al final del archivo o en script tag -->
    <script>
        // Register form functionality
        (function() {
            // Show/hide years practicing based on doctor selection
            const doctorYes = document.getElementById('doctor_yes');
            const doctorNo = document.getElementById('doctor_no');
            const yearsSection = document.getElementById('yearsSection');
            const yearsInput = document.getElementById('years');
            
            if (doctorYes) {
                doctorYes.addEventListener('change', function() {
                    if (this.checked) {
                        yearsSection.style.display = 'flex';
                    }
                });
            }
            
            if (doctorNo) {
                doctorNo.addEventListener('change', function() {
                    if (this.checked) {
                        yearsSection.style.display = 'none';
                        yearsInput.value = '';
                    }
                });
            }
            
            // Validate years input
            if (yearsInput) {
                yearsInput.addEventListener('input', function(e) {
                    this.value = this.value.replace(/[^0-9]/g, '');
                    if (parseInt(this.value) > 70) {
                        this.value = '70';
                    }
                });
            }
            
            // Email validation
            const commonDomains = {
                'gmail.com': ['gmai.com', 'gmial.com', 'gmail.co', 'gmail.cm', 'gmail.con'],
                'hotmail.com': ['hotmai.com', 'hotmial.com', 'hotmail.co', 'hotmail.cm'],
                'yahoo.com': ['yaho.com', 'yahoo.co', 'yahoo.cm', 'yahooo.com'],
                'outlook.com': ['outlok.com', 'outlook.co', 'outlook.cm'],
                'icloud.com': ['iclod.com', 'icloud.co', 'icloud.cm']
            };
            
            const emailInput = document.getElementById('email');
            const emailValidation = document.getElementById('emailValidation');
            let validationTimeout;
            
            function findCorrectDomain(typo) {
                for (const [correct, typos] of Object.entries(commonDomains)) {
                    if (typos.includes(typo.toLowerCase())) {
                        return correct;
                    }
                }
                return null;
            }
            
            function validateEmailDomain(email) {
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                
                if (!email || !email.includes('@')) {
                    return null;
                }
                
                const parts = email.split('@');
                if (parts.length !== 2) {
                    return { type: 'error', message: 'Formato de email inválido' };
                }
                
                const domain = parts[1].toLowerCase();
                
                if (!domain || domain === '.' || domain.startsWith('.')) {
                    return { type: 'error', message: 'El dominio del email está incompleto' };
                }
                
                if (!domain.includes('.')) {
                    return { type: 'error', message: 'Falta la extensión del dominio (ej: .com)' };
                }
                
                if (domain.includes('..')) {
                    return { type: 'error', message: 'El dominio contiene puntos duplicados' };
                }
                
                const correctDomain = findCorrectDomain(domain);
                if (correctDomain) {
                    return { 
                        type: 'warning', 
                        message: `¿Quisiste decir ${parts[0]}@${correctDomain}?`,
                        suggestion: `${parts[0]}@${correctDomain}`
                    };
                }
                
                if (emailRegex.test(email)) {
                    return { type: 'success', message: '✓ Email válido' };
                }
                
                return null;
            }
            
            function showValidation(result) {
                if (!result) {
                    emailValidation.classList.remove('show', 'error', 'warning', 'success');
                    return;
                }
                
                emailValidation.innerHTML = result.message;
                
                if (result.suggestion) {
                    emailValidation.style.cursor = 'pointer';
                    emailValidation.onclick = () => {
                        emailInput.value = result.suggestion;
                        validateEmail();
                    };
                } else {
                    emailValidation.style.cursor = 'default';
                    emailValidation.onclick = null;
                }
                
                emailValidation.classList.remove('error', 'warning', 'success');
                emailValidation.classList.add('show', result.type);
            }
            
            function validateEmail() {
                const email = emailInput.value;
                const result = validateEmailDomain(email);
                showValidation(result);
            }
            
            if (emailInput) {
                emailInput.addEventListener('input', (e) => {
                    clearTimeout(validationTimeout);
                    if (e.target.value.includes('@')) {
                        validationTimeout = setTimeout(() => {
                            validateEmail();
                        }, 500);
                    } else {
                        emailValidation.classList.remove('show');
                    }
                });
                
                emailInput.addEventListener('blur', () => {
                    if (emailInput.value) {
                        validateEmail();
                    }
                });
            }
            
            // Phone formatting
            const phoneInput = document.getElementById('phone');
            if (phoneInput) {
                phoneInput.addEventListener('input', (e) => {
                    let value = e.target.value.replace(/\D/g, '');
                    if (value.length > 0) {
                        if (value.length <= 3) {
                            value = `(${value}`;
                        } else if (value.length <= 6) {
                            value = `(${value.slice(0, 3)}) ${value.slice(3)}`;
                        } else {
                            value = `(${value.slice(0, 3)}) ${value.slice(3, 6)}-${value.slice(6, 10)}`;
                        }
                    }
                    e.target.value = value;
                });
            }
            
            // Form validation on submit
            const registerForm = document.getElementById('registerForm');
            if (registerForm) {
                registerForm.addEventListener('submit', (e) => {
                    const email = emailInput.value;
                    const validation = validateEmailDomain(email);
                    
                    if (validation && validation.type === 'error') {
                        e.preventDefault();
                        emailInput.focus();
                        showValidation(validation);
                        return false;
                    }
                    
                    if (validation && validation.type === 'warning') {
                        const proceed = confirm(`Posible error en el email. ${validation.message}\n\n¿Deseas continuar?`);
                        if (!proceed) {
                            e.preventDefault();
                            emailInput.focus();
                            return false;
                        }
                    }
                });
            }
        })();
    </script>
    
    <script>
        // Hide loader when page is ready
        window.addEventListener('load', function() {
            setTimeout(function() {
                document.getElementById('loader').classList.add('hidden');
            }, 500);
        });
        
        // Mobile menu toggle
        const menuToggle = document.getElementById('menuToggle');
        const mobileMenu = document.getElementById('mobileMenu');
        
        menuToggle.addEventListener('click', function() {
            mobileMenu.classList.toggle('active');
        });
        
        // Close mobile menu when clicking on a link
        document.querySelectorAll('.mobile-menu a').forEach(link => {
            link.addEventListener('click', function() {
                mobileMenu.classList.remove('active');
            });
        });
        
        // Header scroll effect
        window.addEventListener('scroll', function() {
            const header = document.getElementById('header');
            if (window.scrollY > 50) {
                header.classList.add('scrolled');
            } else {
                header.classList.remove('scrolled');
            }
        });
        
        // Smooth scrolling for anchor links
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    const headerHeight = document.getElementById('header').offsetHeight;
                    const targetPosition = target.getBoundingClientRect().top + window.scrollY - headerHeight;
                    window.scrollTo({
                        top: targetPosition,
                        behavior: 'smooth'
                    });
                }
            });
        });
        
        // Animate on scroll
        const observerOptions = {
            threshold: 0.1,
            rootMargin: '0px 0px -100px 0px'
        };
        
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('animated');
                }
            });
        }, observerOptions);
        
        document.querySelectorAll('.animate-on-scroll').forEach(el => {
            observer.observe(el);
        });
        
        // Countdown timer
        function updateCountdown() {
            fetch('{% url "landing:countdown-api" %}')
                .then(response => response.json())
                .then(data => {
                    if (data.ended) {
                        document.getElementById('countdown').innerHTML = `
                            <h3 style="color: var(--teal-primary);">${data.message}</h3>
                        `;
                    } else {
                        document.getElementById('days').textContent = String(data.days).padStart(2, '0');
                        document.getElementById('hours').textContent = String(data.hours).padStart(2, '0');
                        document.getElementById('minutes').textContent = String(data.minutes).padStart(2, '0');
                        document.getElementById('seconds').textContent = String(data.seconds).padStart(2, '0');
                    }
                })
                .catch(error => console.error('Error updating countdown:', error));
        }
        
        // Update countdown every second
        setInterval(updateCountdown, 1000);
    </script>
    
    {% if messages %}
    <script>
        // Display Django messages if any
        {% for message in messages %}
            alert('{{ message }}');
        {% endfor %}
    </script>
    {% endif %}
</body>
</html>