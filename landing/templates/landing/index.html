{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="{{ meta.description }}">
    <meta name="keywords" content="{{ meta.keywords }}">
    
    <!-- Open Graph Meta Tags -->
    <meta property="og:title" content="{{ meta.title }}">
    <meta property="og:description" content="{{ meta.description }}">
    <meta property="og:image" content="{% static meta.og_image %}">
    <meta property="og:url" content="{{ request.build_absolute_uri }}">
    
    <title>{{ meta.title }}</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="{% static 'landing/img/favicon.png' %}">

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700;800&family=Inter:wght@300;400;500;600&family=Great+Vibes&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="{% static 'landing/css/styles.css' %}">

    <style>
.checkbox-group {
    padding: 15px 0;
}

.checkbox-label {
    display: flex;
    align-items: flex-start;
    cursor: pointer;
    font-size: 0.9rem;
    line-height: 1.5;
}

.checkbox-label input[type="checkbox"] {
    margin-right: 12px;
    margin-top: 3px;
    width: 20px;
    height: 20px;
    cursor: pointer;
    accent-color: #4DB6AC;
    flex-shrink: 0;
}

.checkbox-text {
    color: #333;
    user-select: none;
}

.checkbox-text a {
    color: #4DB6AC;
    text-decoration: underline;
}

.checkbox-text a:hover {
    color: #377e7c;
}

/* Success message styles */
.success-message {
    background: #D1FAE5;
    border: 2px solid #059669;
    color: #065F46;
    padding: 20px;
    border-radius: 12px;
    margin: 20px 0;
    text-align: center;
    font-weight: 600;
    font-size: 1.1rem;
    display: none;
    animation: slideDown 0.5s ease;
}

.success-message.show {
    display: block;
}

.success-message i {
    color: #059669;
    font-size: 2rem;
    display: block;
    margin-bottom: 10px;
}

/* Estilos para los botones de monto */
.amount-btn:hover {
    background: #4DB6AC !important;
    color: white !important;
    transform: translateY(-2px);
}

.amount-btn.active {
    background: #4DB6AC !important;
    color: white !important;
    box-shadow: 0 4px 12px rgba(77, 182, 172, 0.4);
}

/* Estilos para el estado del pago */
.payment-status.success {
    background: #D1FAE5;
    border: 2px solid #059669;
    color: #065F46;
    display: block !important;
}

.payment-status.error {
    background: #FEE2E2;
    border: 2px solid #DC2626;
    color: #991B1B;
    display: block !important;
}

.payment-status.processing {
    background: #DBEAFE;
    border: 2px solid #2563EB;
    color: #1E40AF;
    display: block !important;
}

</style>
</head>
<body>
    <!-- Loader -->
     <div class="loader" id="loader">
        <div class="loader-spinner"></div>
    </div>
    
    <!-- Header -->
    <!-- <header class="header" id="header">
        <nav class="navbar">
            <div class="logo-container">
                <img src="{% static 'landing/img/navbar-logo.png' %}" alt="{{ candidate.campaign_slogan }}" class="logo-img">
            </div>
            <button class="menu-toggle" id="menuToggle">
                <span>‚ò∞</span>
            </button>
        </nav> -->
        
         <!-- Mobile Menu -->
        <!-- <div class="mobile-menu" id="mobileMenu">
            <a href="#hero">Inicio</a>
            <a href="#team">Equipo</a>
            <a href="#plan">Plan Estrat√©gico</a>
            <a href="#donate">Donar</a>
            <a href="#register">Registrarse</a>
            <a href="#contact">Contacto</a>
        </div>
    </header> -->
    
    <!-- Hero Section -->
    <!-- <section class="hero" id="hero">
        <div class="hero-content">
            <img src="{% static 'landing/img/logo-renovar.png' %}" alt="Dr. M√©ndez Sexto" class="hero-logo">

            <p class="hero-text">
                Lorem ipsum dolor sit amet, consectetur adipiscing elit.
            </p>
        </div>
    </section> -->

    <!-- Countdown Section -->
    <!-- <section class="countdown-section">
        <div class="countdown-wrapper">
            <h2 class="countdown-title">Lorem ipsum dolor</h2>
            
            <div class="countdown-display">
                <div class="countdown-row">
                    <div class="countdown-unit">
                        <span class="countdown-value" id="days-mini">{{ countdown.days }}</span>
                        <span class="countdown-label">D√≠as</span>
                    </div>
                </div>
                
                <div class="countdown-row">
                    <div class="countdown-unit">
                        <span class="countdown-value" id="hours-mini">{{ countdown.hours }}</span>
                        <span class="countdown-label">Horas</span>
                    </div>
                </div>
                
                <div class="countdown-row">
                    <div class="countdown-unit">
                        <span class="countdown-value" id="minutes-mini">{{ countdown.minutes }}</span>
                        <span class="countdown-label">Minutos</span>
                    </div>
                </div>
                
                <div class="countdown-row">
                    <div class="countdown-unit">
                        <span class="countdown-value" id="seconds-mini">{{ countdown.seconds }}</span>
                        <span class="countdown-label">Segundos</span>
                    </div>
                </div>
            </div>
        </div>
    </section> -->
    
    <!-- Team Section -->
    <!-- <section class="team-section" id="team">
        <div class="section-header">
            <div class="section-header-content">
                <h2>Nuestro</h2>
                <div class="script">Equipo</div>
            </div>
        </div>
        <div class="container">
            <div class="team-grid">
                {% for member in team_members %}
                <div class="team-member animate-on-scroll">
                    <div class="team-member-image">
                        {% if member.image %}
                        <img src="{% static member.image %}" alt="{{ member.name }}">
                        {% else %}
                        <img src="{% static 'landing/img/placeholder-avatar.jpg' %}" alt="{{ member.name }}">
                        {% endif %}
                    </div>
                    <h3>{{ member.name }}</h3>
                    <p class="role">{{ member.role }}</p>
                    <p class="district">{{ member.district }}</p>
                </div>
                {% endfor %} -->
                
                <!-- Featured Member -->
                <!-- <div class="team-member juan-destacado animate-on-scroll">
                    <div class="team-member-image">
                        {% if featured_member.image %}
                        <img src="{% static featured_member.image %}" alt="{{ featured_member.name }}">
                        {% else %}
                        <img src="{% static 'landing/img/placeholder-avatar.jpg' %}" alt="{{ featured_member.name }}">
                        {% endif %}
                    </div>
                    <h3>{{ featured_member.name }}</h3>
                    <p class="role">{{ featured_member.role }}</p>
                    <p class="district">{{ featured_member.district }}</p>
                </div>
            </div>
        </div>
    </section> -->
    
    <!-- Strategic Plan Section -->
    <!-- <section class="strategic-plan" id="plan">
        <div class="container">
            <h2>Plan</h2>
            <div class="script">Estrat√©gico</div>
            
            <div class="plan-cards">
                {% for plan in strategic_plans %}
                <div class="plan-card animate-on-scroll">
                    <h3>{{ plan.title }}</h3>
                    <p>{{ plan.description }}</p>
                    <a href="#" class="btn btn-teal-outline">Leer m√°s</a>
                </div>
                {% endfor %}
            </div>
        </div>
    </section> -->
    
    <!-- Donation Section -->
    <section class="donation-section" id="donate">
        <div class="container">
            <div class="donation-content animate-on-scroll">
                <h2>¬°√önete!</h2>
                
                <div class="donation-info">
                    <p>Haz tu donativo a trav√©s de {{ donation.platform }} a:</p>
                    <div class="donation-handle">{{ donation.handle }}</div>
                </div>
                
                <!-- Selector de monto -->
                <div class="amount-selection" style="margin: 30px 0;">
                    <h3 style="color: #377e7c; margin-bottom: 20px; text-align: center;">Selecciona el monto</h3>
                    <div class="amount-buttons" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); gap: 15px; max-width: 600px; margin: 0 auto 20px;">
                        <button class="amount-btn" data-amount="25" style="padding: 12px; border: 2px solid #4DB6AC; background: white; color: #377e7c; border-radius: 10px; font-size: 1.1rem; font-weight: 600; cursor: pointer; transition: all 0.3s ease;">$25</button>
                        <button class="amount-btn" data-amount="50" style="padding: 12px; border: 2px solid #4DB6AC; background: white; color: #377e7c; border-radius: 10px; font-size: 1.1rem; font-weight: 600; cursor: pointer; transition: all 0.3s ease;">$50</button>
                        <button class="amount-btn" data-amount="100" style="padding: 12px; border: 2px solid #4DB6AC; background: white; color: #377e7c; border-radius: 10px; font-size: 1.1rem; font-weight: 600; cursor: pointer; transition: all 0.3s ease;">$100</button>
                        <button class="amount-btn active" data-amount="250" style="padding: 12px; border: 2px solid #4DB6AC; background: #4DB6AC; color: white; border-radius: 10px; font-size: 1.1rem; font-weight: 600; cursor: pointer; transition: all 0.3s ease;">$250</button>
                        <button class="amount-btn" data-amount="500" style="padding: 12px; border: 2px solid #4DB6AC; background: white; color: #377e7c; border-radius: 10px; font-size: 1.1rem; font-weight: 600; cursor: pointer; transition: all 0.3s ease;">$500</button>
                        <button class="amount-btn" data-amount="1000" style="padding: 12px; border: 2px solid #4DB6AC; background: white; color: #377e7c; border-radius: 10px; font-size: 1.1rem; font-weight: 600; cursor: pointer; transition: all 0.3s ease;">$1,000</button>
                    </div>
                    
                    <div class="custom-amount" style="text-align: center; max-width: 400px; margin: 0 auto;">
                        <input type="number" 
                            id="customDonationAmount" 
                            placeholder="Otra cantidad ($1 - $1,500)" 
                            min="1" 
                            max="1500" 
                            step="0.01"
                            style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 10px; font-size: 1rem; text-align: center;">
                    </div>
                </div>
                
                <!-- Informaci√≥n del donante (opcional) -->
                <!-- <div class="donor-info" style="max-width: 500px; margin: 30px auto; background: rgba(255,255,255,0.1); padding: 20px; border-radius: 15px;">
                    <p style="text-align: center; margin-bottom: 15px; font-size: 0.9rem; color: #fff;">Informaci√≥n opcional del donante:</p>
                    <input type="text" 
                        id="donorName" 
                        placeholder="Nombre completo (opcional)"
                        style="width: 100%; padding: 10px; margin-bottom: 10px; border: 2px solid rgba(255,255,255,0.3); background: rgba(255,255,255,0.9); border-radius: 8px; font-size: 0.95rem;">
                    <input type="email" 
                        id="donorEmail" 
                        placeholder="Correo electr√≥nico (opcional)"
                        style="width: 100%; padding: 10px; margin-bottom: 10px; border: 2px solid rgba(255,255,255,0.3); background: rgba(255,255,255,0.9); border-radius: 8px; font-size: 0.95rem;">
                    <input type="tel" 
                        id="donorPhone" 
                        placeholder="Tel√©fono (opcional)"
                        style="width: 100%; padding: 10px; border: 2px solid rgba(255,255,255,0.3); background: rgba(255,255,255,0.9); border-radius: 8px; font-size: 0.95rem;">
                </div> -->
                
                <!-- Estado del pago -->
                <div id="paymentStatusDonation" class="payment-status" style="display: none; padding: 20px; border-radius: 10px; margin: 20px auto; max-width: 600px; text-align: center;"></div>
                
                <!-- ATH M√≥vil Payment Button -->

                <div id="ATHMovil_Checkout_Button_payment"></div>
                
                <p class="legal-text">{{ donation.legal_text }}</p>
                
                <div class="hashtag">{{ donation.hashtag }}</div>
            </div>
        </div>
    </section>
    
<!-- Register Section - A√±adir esto en el index.html despu√©s de la secci√≥n de donaci√≥n -->
<section class="register-section" id="register">
    <div class="container">
        <div class="register-wrapper">
            <div class="register-header">
                <div class="header-badge">Registro</div>
                
                <div class="title-section">
                    <div class="title-main">¬°Iniciemos la</div>
                    <div class="title-script">renovaci√≥n!</div>
                    
                    <div class="doctor-name">
                        <img src="{% static 'landing/img/logo-mendez.png' %}" alt="Dr. M√©ndez Sexto">
                    </div>
                    
                    <div class="campaign-hashtag">#RenovarParaAvanzar</div>
                </div>
            </div>
            
            <div class="register-form-container">
                <form method="post" action="{% url 'landing:register' %}" id="registerForm" class="register-form">
                    {% csrf_token %}
                    
                    <div class="form-row">
                        <div class="form-group">
                            <input type="text" name="name" placeholder="Nombre" required>
                        </div>
                        
                        <div class="form-group">
                            <input type="text" name="last_name" placeholder="Apellidos" required>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <input type="email" name="email" id="email" placeholder="Correo electr√≥nico" required>
                        <div class="email-validation" id="emailValidation"></div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <input type="text" name="postal_address" placeholder="Direcci√≥n postal" required>
                        </div>
                        
                        <div class="form-group">
                            <input type="tel" name="phone_number" id="phone" placeholder="N√∫mero telef√≥nico" required>
                        </div>
                    </div>
                    
                    <div class="question-group">
                        <div class="question-section">¬øEres m√©dico?</div>
                        <div class="radio-group">
                            <div class="radio-option">
                                <label>S√≠</label>
                                <input type="radio" name="is_doctor" value="True" id="doctor_yes" required>
                            </div>
                            <div class="radio-option">
                                <label>No</label>
                                <input type="radio" name="is_doctor" value="False" id="doctor_no">
                            </div>
                        </div>
                    </div>

                    <!-- INICIO DEL DIV QUE SE OCULTA -->
                    <div id="doctorFields" style="display: none;">
                        
                        <div class="form-group">
                            <input type="text" name="specialty" id="specialty" placeholder="Especialidad que practica">
                        </div>
                        
                        <div class="years-section">
                            <span>A√±os ejerciendo</span>
                            <input type="number" name="years_practicing" id="years" min="0" max="70" placeholder="0">
                        </div>
                        
                        <div class="form-group">
                            <textarea name="service_location" id="service_location" placeholder="¬øD√≥nde ofrece servicios?" rows="2"></textarea>
                        </div>
                        
                        <div class="question-group">
                            <div class="question-section">¬øEres colegiado?</div>
                            <div class="radio-group">
                                <div class="radio-option">
                                    <label>S√≠</label>
                                    <input type="radio" name="is_licensed" value="True" id="licensed_yes">
                                </div>
                                <div class="radio-option">
                                    <label>No</label>
                                    <input type="radio" name="is_licensed" value="False" id="licensed_no">
                                </div>
                            </div>
                        </div>
                        
                    </div>
                    <!-- FIN DEL DIV QUE SE OCULTA -->

                    <!-- ESTE DEBE ESTAR FUERA, SIEMPRE VISIBLE -->
                    <div class="question-group">
                        <div class="question-section" style="font-size: .75rem;">¬øDesea voto adelantado?</div>
                        <div class="radio-group">
                            <div class="radio-option">
                                <label>S√≠</label>
                                <input type="radio" name="needs_voting_help" value="True" required>
                            </div>
                            <div class="radio-option">
                                <label>No</label>
                                <input type="radio" name="needs_voting_help" value="False">
                            </div>
                        </div>
                    </div>

                    <!-- Checkbox de t√©rminos y condiciones -->
                    <div class="checkbox-group" style="margin: 25px 0;">
                        <label class="checkbox-label">
                            <input type="checkbox" 
                                name="accepts_terms" 
                                id="accepts_terms" 
                                required 
                                checked>
                            <span class="checkbox-text">
                                Acepto los <a href="{% url 'landing:terms' %}" style="color: #4DB6AC; text-decoration: underline;">t√©rminos y condiciones</a>
                            </span>
                        </label>
                    </div>

                    <!-- Checkbox de promociones -->
                    <div class="checkbox-group" style="margin: 25px 0;">
                        <label class="checkbox-label">
                            <input type="checkbox" 
                                name="accepts_promotions" 
                                id="accepts_promotions" 
                                checked>
                            <span class="checkbox-text">
                                Acepto recibir informaci√≥n sobre la campa√±a y actividades
                            </span>
                        </label>
                    </div>
                    
                    <button type="submit" class="register-submit-btn">Someter</button>
                </form>
            </div>
        </div>
    </div>
</section>

    
    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <h3>{{ candidate.name }}</h3>
                <p class="subtitle">Candidato a la Presidencia del Colegio de M√©dicos Cirujanos de Puerto Rico</p>
                <h4>Conteo Regresivo para elecciones.</h4>
            </div>
            
            <div class="countdown" id="countdown">
                <div class="countdown-item">
                    <span class="countdown-number" id="days">{{ countdown.days }}</span>
                    <span class="countdown-label">D√≠as</span>
                </div>
                <div class="countdown-item">
                    <span class="countdown-number" id="hours">{{ countdown.hours }}</span>
                    <span class="countdown-label">Horas</span>
                </div>
                <div class="countdown-item">
                    <span class="countdown-number" id="minutes">{{ countdown.minutes }}</span>
                    <span class="countdown-label">Minutos</span>
                </div>
                <div class="countdown-item">
                    <span class="countdown-number" id="seconds">{{ countdown.seconds }}</span>
                    <span class="countdown-label">Segundos</span>
                </div>
            </div>
            
            <div class="social-links">
                {% if social_media.facebook %}
                <a href="https://www.facebook.com/share/17NsSyDXX3/?mibextid=wwXIfr" target="_blank" class="social-link"><i class="fab fa-facebook-f"></i></a>
                {% endif %}
                {% if social_media.twitter %}
                <a href="https://x.com/drmendezsexto?s=21" target="_blank" class="social-link"><i class="fab fa-x-twitter"></i></a>
                {% endif %}
                {% if social_media.instagram %}
                <a href="https://www.instagram.com/drmendezsexto?igsh=Ym9hamN3ZG5idmd3" target="_blank" class="social-link"><i class="fab fa-instagram"></i></a>
                {% endif %}
            </div>
            <div class="copyright">
                <p>&copy; 2025 {{ candidate.campaign_slogan }}. Todos los derechos reservados.</p>
                <p style="margin-top: 10px; font-size: 0.8rem;">
                    Powered By Dominio
                </p>
            </div>
        </div>
    </footer>
    <!-- JavaScript para a√±adir al final del archivo o en script tag -->
    <script>
    // Register form functionality
    (function() {
        // Show/hide years practicing based on doctor selection
        const doctorYes = document.getElementById('doctor_yes');
        const doctorNo = document.getElementById('doctor_no');
        const doctorFields = document.getElementById('doctorFields');
        const yearsInput = document.getElementById('years');
        const specialtyInput = document.getElementById('specialty');
        const serviceLocationInput = document.getElementById('service_location');
        const licensedYes = document.getElementById('licensed_yes');
        const licensedNo = document.getElementById('licensed_no');
        
        if (doctorNo) {
            doctorNo.addEventListener('change', function() {
                if (this.checked) {
                    if (doctorFields) doctorFields.style.display = 'none';
                    
                    // Limpiar y deshabilitar campos
                    if (yearsInput) {
                        yearsInput.value = '';
                        yearsInput.disabled = true;
                        yearsInput.removeAttribute('required');
                    }
                    if (specialtyInput) {
                        specialtyInput.value = '';
                        specialtyInput.disabled = true;
                        specialtyInput.removeAttribute('required');
                    }
                    if (serviceLocationInput) {
                        serviceLocationInput.value = '';
                        serviceLocationInput.disabled = true;
                        serviceLocationInput.removeAttribute('required');
                    }
                    if (licensedYes) {
                        licensedYes.checked = false;
                        licensedYes.disabled = true;
                        licensedYes.removeAttribute('required');
                    }
                    if (licensedNo) {
                        licensedNo.checked = false;
                        licensedNo.disabled = true;
                        licensedNo.removeAttribute('required');
                    }
                }
            });
        }

        if (doctorYes) {
            doctorYes.addEventListener('change', function() {
                if (this.checked) {
                    if (doctorFields) doctorFields.style.display = 'block';
                    
                    // Habilitar campos
                    if (yearsInput) yearsInput.disabled = false;
                    if (specialtyInput) specialtyInput.disabled = false;
                    if (serviceLocationInput) serviceLocationInput.disabled = false;
                    if (licensedYes) {
                        licensedYes.disabled = false;
                        licensedYes.setAttribute('required', 'required');
                    }
                    if (licensedNo) {
                        licensedNo.disabled = false;
                    }
                }
            });
        }
        
        // Validate years input
        if (yearsInput) {
            yearsInput.addEventListener('input', function(e) {
                this.value = this.value.replace(/[^0-9]/g, '');
                if (parseInt(this.value) > 70) {
                    this.value = '70';
                }
            });
        }
        
        // Email validation
        const commonDomains = {
            'gmail.com': ['gmai.com', 'gmial.com', 'gmail.co', 'gmail.cm', 'gmail.con'],
            'hotmail.com': ['hotmai.com', 'hotmial.com', 'hotmail.co', 'hotmail.cm'],
            'yahoo.com': ['yaho.com', 'yahoo.co', 'yahoo.cm', 'yahooo.com'],
            'outlook.com': ['outlok.com', 'outlook.co', 'outlook.cm'],
            'icloud.com': ['iclod.com', 'icloud.co', 'icloud.cm']
        };
        
        const emailInput = document.getElementById('email');
        const emailValidation = document.getElementById('emailValidation');
        let validationTimeout;
        
        function findCorrectDomain(typo) {
            for (const [correct, typos] of Object.entries(commonDomains)) {
                if (typos.includes(typo.toLowerCase())) {
                    return correct;
                }
            }
            return null;
        }
        
        function validateEmailDomain(email) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            
            if (!email || !email.includes('@')) {
                return null;
            }
            
            const parts = email.split('@');
            if (parts.length !== 2) {
                return { type: 'error', message: 'Formato de email inv√°lido' };
            }
            
            const domain = parts[1].toLowerCase();
            
            if (!domain || domain === '.' || domain.startsWith('.')) {
                return { type: 'error', message: 'El dominio del email est√° incompleto' };
            }
            
            if (!domain.includes('.')) {
                return { type: 'error', message: 'Falta la extensi√≥n del dominio (ej: .com)' };
            }
            
            if (domain.includes('..')) {
                return { type: 'error', message: 'El dominio contiene puntos duplicados' };
            }
            
            const correctDomain = findCorrectDomain(domain);
            if (correctDomain) {
                return { 
                    type: 'warning', 
                    message: `¬øQuisiste decir ${parts[0]}@${correctDomain}?`,
                    suggestion: `${parts[0]}@${correctDomain}`
                };
            }
            
            if (emailRegex.test(email)) {
                return { type: 'success', message: '‚úì Email v√°lido' };
            }
            
            return null;
        }
        
        function showValidation(result) {
            if (!emailValidation) return;
            
            if (!result) {
                emailValidation.classList.remove('show', 'error', 'warning', 'success');
                return;
            }
            
            emailValidation.innerHTML = result.message;
            
            if (result.suggestion) {
                emailValidation.style.cursor = 'pointer';
                emailValidation.onclick = () => {
                    emailInput.value = result.suggestion;
                    validateEmail();
                };
            } else {
                emailValidation.style.cursor = 'default';
                emailValidation.onclick = null;
            }
            
            emailValidation.classList.remove('error', 'warning', 'success');
            emailValidation.classList.add('show', result.type);
        }
        
        function validateEmail() {
            if (!emailInput) return;
            const email = emailInput.value;
            const result = validateEmailDomain(email);
            showValidation(result);
        }
        
        if (emailInput) {
            emailInput.addEventListener('input', (e) => {
                clearTimeout(validationTimeout);
                if (e.target.value.includes('@')) {
                    validationTimeout = setTimeout(() => {
                        validateEmail();
                    }, 500);
                } else if (emailValidation) {
                    emailValidation.classList.remove('show');
                }
            });
            
            emailInput.addEventListener('blur', () => {
                if (emailInput.value) {
                    validateEmail();
                }
            });
        }
        
        // Phone formatting
        const phoneInput = document.getElementById('phone');
        if (phoneInput) {
            phoneInput.addEventListener('input', (e) => {
                let value = e.target.value.replace(/\D/g, '');
                if (value.length > 0) {
                    if (value.length <= 3) {
                        value = `(${value}`;
                    } else if (value.length <= 6) {
                        value = `(${value.slice(0, 3)}) ${value.slice(3)}`;
                    } else {
                        value = `(${value.slice(0, 3)}) ${value.slice(3, 6)}-${value.slice(6, 10)}`;
                    }
                }
                e.target.value = value;
            });
        }
        
        // Form validation on submit
        const registerForm = document.getElementById('registerForm');
        if (registerForm && emailInput) {
            registerForm.addEventListener('submit', (e) => {
                const email = emailInput.value;
                const validation = validateEmailDomain(email);
                
                if (validation && validation.type === 'error') {
                    e.preventDefault();
                    emailInput.focus();
                    showValidation(validation);
                    return false;
                }
                
                if (validation && validation.type === 'warning') {
                    const proceed = confirm(`Posible error en el email. ${validation.message}\n\n¬øDeseas continuar?`);
                    if (!proceed) {
                        e.preventDefault();
                        emailInput.focus();
                        return false;
                    }
                }
            });
        }
    })();
</script>

<script>
    // Elementos de la p√°gina
    const pageLoader = document.getElementById('loader');
    const menuToggle = document.getElementById('menuToggle');
    const mobileMenu = document.getElementById('mobileMenu');
    const header = document.getElementById('header');
    
    // Hide loader when page is ready
    if (pageLoader) {
        window.addEventListener('load', function() {
            setTimeout(function() {
                pageLoader.classList.add('hidden');
            }, 500);
        });
    }
    
    // Mobile menu toggle
    if (menuToggle && mobileMenu) {
        menuToggle.addEventListener('click', function() {
            mobileMenu.classList.toggle('active');
        });
        
        // Close mobile menu when clicking on a link
        document.querySelectorAll('.mobile-menu a').forEach(link => {
            link.addEventListener('click', function() {
                mobileMenu.classList.remove('active');
            });
        });
    }
    
    // Header scroll effect
    if (header) {
        window.addEventListener('scroll', function() {
            if (window.scrollY > 50) {
                header.classList.add('scrolled');
            } else {
                header.classList.remove('scrolled');
            }
        });
    }
    
    // Smooth scrolling for anchor links
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
            e.preventDefault();
            const target = document.querySelector(this.getAttribute('href'));
            if (target) {
                const headerHeight = header ? header.offsetHeight : 0;
                const targetPosition = target.getBoundingClientRect().top + window.scrollY - headerHeight;
                window.scrollTo({
                    top: targetPosition,
                    behavior: 'smooth'
                });
            }
        });
    });
    
    // Animate on scroll
    const observerOptions = {
        threshold: 0.1,
        rootMargin: '0px 0px -100px 0px'
    };
    
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.classList.add('animated');
            }
        });
    }, observerOptions);
    
    document.querySelectorAll('.animate-on-scroll').forEach(el => {
        observer.observe(el);
    });
    
    // Countdown timer
    function updateCountdown() {
        fetch('{% url "landing:countdown-api" %}')
            .then(response => response.json())
            .then(data => {
                const countdownEl = document.getElementById('countdown');
                if (!countdownEl) return;
                
                if (data.ended) {
                    countdownEl.innerHTML = `
                        <h3 style="color: var(--teal-primary);">${data.message}</h3>
                    `;
                } else {
                    const days = document.getElementById('days');
                    const hours = document.getElementById('hours');
                    const minutes = document.getElementById('minutes');
                    const seconds = document.getElementById('seconds');
                    
                    if (days) days.textContent = String(data.days).padStart(2, '0');
                    if (hours) hours.textContent = String(data.hours).padStart(2, '0');
                    if (minutes) minutes.textContent = String(data.minutes).padStart(2, '0');
                    if (seconds) seconds.textContent = String(data.seconds).padStart(2, '0');
                }
            })
            .catch(error => console.error('Error updating countdown:', error));
    }
    
    // Update countdown every second
    if (document.getElementById('countdown')) {
        setInterval(updateCountdown, 1000);
    }
    
    {% if scroll_to_register %}
    window.addEventListener('load', function() {
        setTimeout(function() {
            const registerSection = document.getElementById('register');
            if (registerSection) {
                registerSection.scrollIntoView({ behavior: 'smooth' });
            }
        }, 600);
    });
    {% endif %}
</script>

{% if messages %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        {% for message in messages %}
            {% if message.tags == 'success' %}
                // Crear el elemento del mensaje
                const successMsg = document.createElement('div');
                successMsg.className = 'success-message show';
                
                let timeLeft = 30;
                const timeDisplay = document.createElement('div');
                timeDisplay.className = 'time-remaining';
                timeDisplay.textContent = `Este mensaje se ocultar√° en ${timeLeft} segundos`;
                
                successMsg.innerHTML = `
                    <i class="fas fa-check-circle"></i>
                    <p>{{ message|safe }}</p>
                `;
                successMsg.appendChild(timeDisplay);
                
                // Insertar el mensaje antes del formulario
                const registerForm = document.getElementById('registerForm');
                if (registerForm) {
                    registerForm.parentElement.insertBefore(successMsg, registerForm);
                    
                    // Scroll hacia el mensaje
                    setTimeout(() => {
                        successMsg.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    }, 100);
                    
                    // Actualizar el contador cada segundo
                    const countdown = setInterval(() => {
                        timeLeft--;
                        if (timeLeft > 0) {
                            timeDisplay.textContent = `Este mensaje se ocultar√° en ${timeLeft} segundos`;
                        } else {
                            clearInterval(countdown);
                        }
                    }, 1000);
                    
                    // Ocultar despu√©s de 30 segundos
                    setTimeout(() => {
                        successMsg.classList.remove('show');
                        setTimeout(() => successMsg.remove(), 500);
                    }, 30000); // 30 segundos
                }
            {% elif message.tags == 'error' %}
                // Mostrar errores con alert
                alert('{{ message|escapejs }}');
            {% else %}
                // Otros tipos de mensajes
                alert('{{ message|escapejs }}');
            {% endif %}
        {% endfor %}
    });
</script>
{% endif %}

<!-- ATH M√≥vil Script -->
<script src="https://payments.athmovil.com/api/js/athmovil_base.js"></script>
<script>
    console.log('üîÑ Cargando script ATH M√≥vil - Version 2.0'); // Para verificar que carg√≥ el nuevo
    
    // Configuraci√≥n de ATH M√≥vil
    let selectedDonationAmount = 250;
    
    // Crear objeto ATHM_Checkout con getters din√°micos
    window.ATHM_Checkout = {
        env: 'production',
        publicToken: 'a937f2e32a4e35ebd2c2850d204fd4dc4b515763',
        timeout: 600,
        theme: 'btn',
        lang: 'es',
        get total() { 
            console.log('üìä ATH leyendo total:', selectedDonationAmount);
            return selectedDonationAmount; 
        },
        get subtotal() { return selectedDonationAmount; },
        tax: 0,
        metadata1: 'Donacion Campa√±a',
        metadata2: 'RenovarParaAvanzar',
        get items() {
            return [{
                "name": "Donaci√≥n Campa√±a",
                "description": "Donaci√≥n para la campa√±a Renovar para Avanzar",
                "quantity": "1",
                "price": selectedDonationAmount.toString(),
                "tax": "0",
                "metadata": "donacion"
            }];
        },
        phoneNumber: ""
    };

    // Funciones de callback
    async function authorizationATHM() {
        const paymentStatus = document.getElementById('paymentStatusDonation');
        
        try {
            const responseAuth = await authorization();
            console.log('‚úÖ Autorizaci√≥n exitosa:', responseAuth);
            
            if (responseAuth && responseAuth.status === 'success') {
                paymentStatus.className = 'payment-status success';
                paymentStatus.style.display = 'block';
                paymentStatus.innerHTML = `
                    <i class="fas fa-check-circle" style="font-size: 2.5rem; display: block; margin-bottom: 15px; color: #059669;"></i>
                    <h3 style="margin: 10px 0; color: #065F46;">¬°Donaci√≥n exitosa!</h3>
                    <p style="margin: 10px 0; color: #065F46;">Gracias por tu donaci√≥n de <strong>$${responseAuth.data.total.toFixed(2)}</strong>.</p>
                    ${responseAuth.data.referenceNumber ? `<p style="margin-top: 15px; font-size: 0.9rem; opacity: 0.8; color: #065F46;">Referencia: ${responseAuth.data.referenceNumber}</p>` : ''}
                `;
                paymentStatus.scrollIntoView({ behavior: 'smooth', block: 'center' });
                setTimeout(() => { paymentStatus.style.display = 'none'; }, 15000);
            }
        } catch (error) {
            console.error('‚ùå Error:', error);
            paymentStatus.className = 'payment-status error';
            paymentStatus.style.display = 'block';
            paymentStatus.innerHTML = `
                <i class="fas fa-exclamation-circle" style="font-size: 2.5rem; display: block; margin-bottom: 15px;"></i>
                <h3 style="margin: 10px 0;">Error en la transacci√≥n</h3>
                <p>${error.message || 'Hubo un problema procesando tu donaci√≥n.'}</p>
            `;
            paymentStatus.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }
    }
    
    async function cancelATHM() {
        const paymentStatus = document.getElementById('paymentStatusDonation');
        
        try {
            const responseCancel = await findPaymentATHM();
            console.log('‚ö†Ô∏è Pago marcado como cancelado:', responseCancel);
            
            // NO mostrar mensaje de error autom√°ticamente
            // Esperar a que el usuario realmente cancele
            
            paymentStatus.className = 'payment-status processing';
            paymentStatus.style.display = 'block';
            paymentStatus.innerHTML = `
                <i class="fas fa-info-circle" style="font-size: 2.5rem; display: block; margin-bottom: 15px;"></i>
                <h3 style="margin: 10px 0;">Revisa tu app ATH M√≥vil</h3>
                <p>Si el pago a√∫n aparece en tu app ATH M√≥vil, conf√≠rmalo desde ah√≠.</p>
                <p style="margin-top: 10px; font-size: 0.9rem;">El pago puede estar activo aunque esta ventana se haya cerrado.</p>
            `;
            paymentStatus.scrollIntoView({ behavior: 'smooth', block: 'center' });
            
            setTimeout(() => {
                paymentStatus.style.display = 'none';
            }, 10000);
        } catch (error) {
            console.error('Error al cancelar:', error);
        }
    }
    
    async function expiredATHM() {
        const paymentStatus = document.getElementById('paymentStatusDonation');
        try {
            const responseExpired = await findPaymentATHM();
            paymentStatus.className = 'payment-status error';
            paymentStatus.style.display = 'block';
            paymentStatus.innerHTML = `
                <i class="fas fa-clock" style="font-size: 2.5rem; display: block; margin-bottom: 15px;"></i>
                <h3 style="margin: 10px 0;">Tiempo expirado</h3>
                <p>El tiempo para completar la transacci√≥n ha expirado.</p>
            `;
            paymentStatus.scrollIntoView({ behavior: 'smooth', block: 'center' });
            setTimeout(() => { paymentStatus.style.display = 'none'; }, 5000);
        } catch (error) {
            console.error('Error en expiraci√≥n:', error);
        }
    }
    
    // Event listeners
    document.addEventListener('DOMContentLoaded', function() {
        console.log('‚úÖ DOM listo, configurando event listeners');
        
        // Botones de monto
        document.querySelectorAll('.amount-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.amount-btn').forEach(b => {
                    b.classList.remove('active');
                    b.style.background = 'white';
                    b.style.color = '#377e7c';
                });
                
                this.classList.add('active');
                this.style.background = '#4DB6AC';
                this.style.color = 'white';
                
                selectedDonationAmount = parseFloat(this.dataset.amount);
                document.getElementById('customDonationAmount').value = '';
                
                console.log('üí∞ Nuevo monto:', selectedDonationAmount);
            });
        });
        
        // Input personalizado
        const customAmountInput = document.getElementById('customDonationAmount');
        if (customAmountInput) {
            customAmountInput.addEventListener('input', function() {
                document.querySelectorAll('.amount-btn').forEach(b => {
                    b.classList.remove('active');
                    b.style.background = 'white';
                    b.style.color = '#377e7c';
                });
                
                const value = parseFloat(this.value);
                if (value >= 1 && value <= 1500) {
                    selectedDonationAmount = value;
                    console.log('üí∞ Monto personalizado:', selectedDonationAmount);
                }
            });
        }
    });
</script>

</body>
</html>